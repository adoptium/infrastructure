---
##############
# VENDOR_FILES
##############

- name: check out AdoptOpenJDK/secrets
  local_action: git repo=git@github.com:AdoptOpenJDK/secrets.git dest=vendor_files force=true
  run_once: true

- name: check if dotgpg is installed
  local_action: shell command -v dotgpg
  run_once: true

- name: generate list of vendor_files
  local_action: command dotgpg cat {{ item }}
  register: vendor_files
  loop: "{{ lookup('fileglob', 'vendor_files/vendor_files/*', wantlist=True) }}"
  run_once: true

- name: set facts from output of dotgpg
  set_fact: {"{{ item.item | basename | replace('.gpg','') | replace('.','_') }}":"{{ item.stdout }}"}
  with_items: "{{vendor_files.results}}"
  run_once: true
